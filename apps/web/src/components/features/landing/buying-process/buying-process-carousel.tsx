'use client'

import { Card, CardContent, cn } from '@tfs-ucmp/ui'
import * as React from 'react'

// Step icons
function RefreshIcon({ className }: { className?: string }) {
  return (
    <svg fill="none" height="37" viewBox="0 0 37 37" width="37" xmlns="http://www.w3.org/2000/svg">
      <mask
        fill="black"
        height="38"
        id="path-1-outside-1_2335_4723"
        maskUnits="userSpaceOnUse"
        width="38"
        x="-0.699951"
        y="-0.700195"
      >
        <rect fill="white" height="38" width="38" x="-0.699951" y="-0.700195" />
        <path d="M14.5383 34.4971V36.2988H0.300049V34.4971H14.5383ZM18.3 0.299805C28.2253 0.299805 36.3 8.37477 36.3 18.2998C36.3 28.0061 28.5772 35.9411 18.9534 36.2861V34.4824C27.5835 34.1385 34.4973 27.0126 34.4973 18.2998C34.4973 9.36817 27.2318 2.10254 18.3 2.10254C9.58713 2.10263 2.46138 9.01661 2.11743 17.6465H0.312744C0.657791 8.02286 8.5936 0.299893 18.3 0.299805ZM11.4299 28.2793V30.082H0.300049V28.2793H11.4299ZM8.32056 22.0625V23.8643H0.300049V22.0625H8.32056ZM19.2014 11.1807V17.9268L23.1389 21.8643L21.8645 23.1387L17.3987 18.6729V11.1807H19.2014Z" />
      </mask>
      <path
        d="M14.5383 34.4971V36.2988H0.300049V34.4971H14.5383ZM18.3 0.299805C28.2253 0.299805 36.3 8.37477 36.3 18.2998C36.3 28.0061 28.5772 35.9411 18.9534 36.2861V34.4824C27.5835 34.1385 34.4973 27.0126 34.4973 18.2998C34.4973 9.36817 27.2318 2.10254 18.3 2.10254C9.58713 2.10263 2.46138 9.01661 2.11743 17.6465H0.312744C0.657791 8.02286 8.5936 0.299893 18.3 0.299805ZM11.4299 28.2793V30.082H0.300049V28.2793H11.4299ZM8.32056 22.0625V23.8643H0.300049V22.0625H8.32056ZM19.2014 11.1807V17.9268L23.1389 21.8643L21.8645 23.1387L17.3987 18.6729V11.1807H19.2014Z"
        fill="#EB0D1C"
      />
      <path
        d="M14.5383 34.4971H14.8383V34.1971H14.5383V34.4971ZM14.5383 36.2988V36.5988H14.8383V36.2988H14.5383ZM0.300049 36.2988H4.88162e-05V36.5988H0.300049V36.2988ZM0.300049 34.4971V34.1971H4.88162e-05V34.4971H0.300049ZM18.3 0.299805V-0.000195324H18.3L18.3 0.299805ZM36.3 18.2998L36.6 18.2998V18.2998H36.3ZM18.9534 36.2861H18.6534V36.5971L18.9641 36.5859L18.9534 36.2861ZM18.9534 34.4824L18.9414 34.1827L18.6534 34.1941V34.4824H18.9534ZM34.4973 18.2998L34.7973 18.2998V18.2998H34.4973ZM18.3 2.10254V1.80254L18.3 1.80254L18.3 2.10254ZM2.11743 17.6465V17.9465H2.40571L2.41719 17.6584L2.11743 17.6465ZM0.312744 17.6465L0.0129368 17.6357L0.00179511 17.9465H0.312744V17.6465ZM11.4299 28.2793H11.7299V27.9793H11.4299V28.2793ZM11.4299 30.082V30.382H11.7299V30.082H11.4299ZM0.300049 30.082H4.88162e-05V30.382H0.300049V30.082ZM0.300049 28.2793V27.9793H4.88162e-05V28.2793H0.300049ZM8.32056 22.0625H8.62056V21.7625H8.32056V22.0625ZM8.32056 23.8643V24.1643H8.62056V23.8643H8.32056ZM0.300049 23.8643H4.88162e-05V24.1643H0.300049V23.8643ZM0.300049 22.0625V21.7625H4.88162e-05V22.0625H0.300049ZM19.2014 11.1807H19.5014V10.8807H19.2014V11.1807ZM19.2014 17.9268H18.9014V18.051L18.9893 18.1389L19.2014 17.9268ZM23.1389 21.8643L23.351 22.0764L23.5632 21.8643L23.351 21.6521L23.1389 21.8643ZM21.8645 23.1387L21.6524 23.3508L21.8645 23.5629L22.0766 23.3508L21.8645 23.1387ZM17.3987 18.6729H17.0987V18.7971L17.1866 18.885L17.3987 18.6729ZM17.3987 11.1807V10.8807H17.0987V11.1807H17.3987ZM14.5383 34.4971H14.2383V36.2988H14.5383H14.8383V34.4971H14.5383ZM14.5383 36.2988V35.9988H0.300049V36.2988V36.5988H14.5383V36.2988ZM0.300049 36.2988H0.600049V34.4971H0.300049H4.88162e-05V36.2988H0.300049ZM0.300049 34.4971V34.7971H14.5383V34.4971V34.1971H0.300049V34.4971ZM18.3 0.299805V0.599805C28.0596 0.599805 36 8.54045 36 18.2998H36.3H36.6C36.6 8.20908 28.3909 -0.000195324 18.3 -0.000195324V0.299805ZM36.3 18.2998L36 18.2998C36 27.844 28.4057 35.6471 18.9426 35.9863L18.9534 36.2861L18.9641 36.5859C28.7487 36.2352 36.6 28.1683 36.6 18.2998L36.3 18.2998ZM18.9534 36.2861H19.2534V34.4824H18.9534H18.6534V36.2861H18.9534ZM18.9534 34.4824L18.9653 34.7822C27.7556 34.4319 34.7973 27.1744 34.7973 18.2998L34.4973 18.2998L34.1973 18.2998C34.1973 26.8509 27.4113 33.8451 18.9414 34.1827L18.9534 34.4824ZM34.4973 18.2998H34.7973C34.7973 9.20249 27.3975 1.80254 18.3 1.80254V2.10254V2.40254C27.0661 2.40254 34.1973 9.53385 34.1973 18.2998H34.4973ZM18.3 2.10254L18.3 1.80254C9.42535 1.80263 2.168 8.84449 1.81767 17.6345L2.11743 17.6465L2.41719 17.6584C2.75475 9.18872 9.74891 2.40263 18.3001 2.40254L18.3 2.10254ZM2.11743 17.6465V17.3465H0.312744V17.6465V17.9465H2.11743V17.6465ZM0.312744 17.6465L0.612552 17.6572C0.951835 8.19435 8.75576 0.599892 18.3001 0.599805L18.3 0.299805L18.3 -0.000195324C8.43145 -0.000105202 0.363747 7.85137 0.0129368 17.6357L0.312744 17.6465ZM11.4299 28.2793H11.1299V30.082H11.4299H11.7299V28.2793H11.4299ZM11.4299 30.082V29.782H0.300049V30.082V30.382H11.4299V30.082ZM0.300049 30.082H0.600049V28.2793H0.300049H4.88162e-05V30.082H0.300049ZM0.300049 28.2793V28.5793H11.4299V28.2793V27.9793H0.300049V28.2793ZM8.32056 22.0625H8.02056V23.8643H8.32056H8.62056V22.0625H8.32056ZM8.32056 23.8643V23.5643H0.300049V23.8643V24.1643H8.32056V23.8643ZM0.300049 23.8643H0.600049V22.0625H0.300049H4.88162e-05V23.8643H0.300049ZM0.300049 22.0625V22.3625H8.32056V22.0625V21.7625H0.300049V22.0625ZM19.2014 11.1807H18.9014V17.9268H19.2014H19.5014V11.1807H19.2014ZM19.2014 17.9268L18.9893 18.1389L22.9268 22.0764L23.1389 21.8643L23.351 21.6521L19.4135 17.7146L19.2014 17.9268ZM23.1389 21.8643L22.9268 21.6521L21.6524 22.9265L21.8645 23.1387L22.0766 23.3508L23.351 22.0764L23.1389 21.8643ZM21.8645 23.1387L22.0766 22.9265L17.6108 18.4607L17.3987 18.6729L17.1866 18.885L21.6524 23.3508L21.8645 23.1387ZM17.3987 18.6729H17.6987V11.1807H17.3987H17.0987V18.6729H17.3987ZM17.3987 11.1807V11.4807H19.2014V11.1807V10.8807H17.3987V11.1807Z"
        fill="#EB0D1C"
        mask="url(#path-1-outside-1_2335_4723)"
      />
    </svg>
  )
}

function SearchIcon({ className }: { className?: string }) {
  return <img alt="Search" className={className} src="/images/buying-process/SearchIcon.png" />
}

function ShieldCheckIcon({ className }: { className?: string }) {
  return (
    <img alt="Shield Check" className={className} src="/images/buying-process/ShieldCheck.png" />
  )
}

function ClipboardIcon({ className }: { className?: string }) {
  return <img alt="Clipboard" className={className} src="/images/buying-process/ClipBoard.png" />
}

interface ProcessStep {
  icon: 'refresh' | 'search' | 'shield' | 'clipboard'
  title: string
  description: string
}

interface BuyingProcessCarouselProps {
  steps: ProcessStep[]
}

const iconMap = {
  refresh: RefreshIcon,
  search: SearchIcon,
  shield: ShieldCheckIcon,
  clipboard: ClipboardIcon,
}

export function BuyingProcessCarousel({ steps }: BuyingProcessCarouselProps) {
  const [currentIndex, setCurrentIndex] = React.useState(0)
  const containerRef = React.useRef<HTMLDivElement>(null)

  const goToSlide = (index: number) => {
    setCurrentIndex(index)
  }

  // Calculate the offset based on card width (85%) + gap (1rem)
  const getTransform = () => {
    if (!containerRef.current) {
      return 'translateX(0)'
    }
    const containerWidth = containerRef.current.offsetWidth
    const cardWidth = containerWidth * 0.9
    const gap = 16
    const offset = currentIndex * (cardWidth + gap)
    // Center the current card
    const centerOffset = (containerWidth - cardWidth) / 2
    return `translateX(${centerOffset - offset}px)`
  }

  return (
    <div className="w-full">
      {/* Desktop: Grid view */}
      <div className="hidden grid-cols-2 gap-2 lg:grid lg:grid-cols-4 lg:gap-6">
        {steps.map((step, index) => {
          const Icon = iconMap[step.icon]
          return (
            <Card className="border-0 bg-white shadow-lg" key={index}>
              <CardContent className="flex flex-col items-center p-4 text-center">
                <div className="mb-4 flex h-10 w-10 items-center justify-center rounded-full bg-primary/10">
                  <Icon className="h-7 w-7 text-primary" />
                </div>
                <h3 className="mb-2 font-semibold text-base text-foreground">{step.title}</h3>
                <p className="text-muted-foreground text-sm leading-relaxed">{step.description}</p>
              </CardContent>
            </Card>
          )
        })}
      </div>

      {/* Mobile: Carousel view */}
      <div className="lg:hidden" ref={containerRef}>
        <div className="relative overflow-visible">
          <div
            className="flex gap-4 transition-transform duration-300 ease-in-out"
            style={{ transform: getTransform() }}
          >
            {steps.map((step, index) => {
              const Icon = iconMap[step.icon]
              return (
                <div className="w-[90%] flex-shrink-0" key={index}>
                  <Card className="border-0 bg-white shadow-lg">
                    <CardContent className="flex flex-col items-center p-6 text-center">
                      <div className="mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-primary/10">
                        <Icon className="h-7 w-7 text-primary" />
                      </div>
                      <h3 className="mb-2 font-semibold text-base text-foreground">{step.title}</h3>
                      <p className="text-muted-foreground text-sm leading-relaxed">
                        {step.description}
                      </p>
                    </CardContent>
                  </Card>
                </div>
              )
            })}
          </div>
        </div>

        {/* Dot indicators */}
        <div className="mt-6 flex justify-center gap-2">
          {steps.map((_, index) => (
            <button
              aria-label={`Go to step ${index + 1}`}
              className={cn(
                'h-2 w-2 rounded-full transition-all',
                index === currentIndex
                  ? 'bg-white ring-2 ring-white ring-offset-2 ring-offset-black'
                  : 'bg-white/40 hover:bg-white/60'
              )}
              key={index}
              onClick={() => goToSlide(index)}
              type="button"
            />
          ))}
        </div>
      </div>
    </div>
  )
}
